<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mini Skype Clone</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f3f4f6; }
    #loginPage, #app { height: 100vh; display: flex; align-items: center; justify-content: center; }
    #app { display: none; }
    #loginBox {
      background: white; padding: 2rem; border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 300px; text-align: center;
    }
    #loginBox input, #loginBox button {
      width: 100%; padding: 0.75rem; margin-top: 0.5rem; border-radius: 0.5rem;
      border: 1px solid #ddd; font-size: 1rem;
    }
    #loginBox button { background: #2563eb; color: white; border: none; cursor: pointer; }
    #loginBox button:hover { background: #1d4ed8; }

    #mainApp { display: flex; width: 100%; height: 100%; }
    #sidebar {
      width: 220px; background: white; border-right: 1px solid #ddd;
      display: flex; flex-direction: column; padding: 1rem;
    }
    #sidebar h2 { font-size: 1.2rem; margin-bottom: 1rem; }
    #contacts { flex: 1; }
    .contact { padding: 0.5rem; margin-bottom: 0.5rem; background: #f3f4f6; border-radius: 0.5rem; }
    #logout { background: #ef4444; color: white; padding: 0.5rem; border-radius: 0.5rem; text-align: center; cursor: pointer; }
    #logout:hover { background: #dc2626; }

    #content { flex: 1; display: flex; padding: 1rem; gap: 1rem; }
    #chat {
      flex: 1; background: white; border-radius: 1rem;
      display: flex; flex-direction: column;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    #messages { flex: 1; padding: 1rem; overflow-y: auto; }
    #chatInput { display: flex; padding: 0.5rem; border-top: 1px solid #ddd; }
    #chatInput input { flex: 1; padding: 0.5rem; border-radius: 0.5rem; border: 1px solid #ddd; }
    #chatInput button {
      margin-left: 0.5rem; background: #2563eb; color: white; border: none;
      border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer;
    }
    #chatInput button:hover { background: #1d4ed8; }
  </style>
</head>
<body>

<!-- Page login -->
<div id="loginPage">
  <div id="loginBox">
    <h1>Connexion</h1>
    <input id="usernameInput" type="text" placeholder="Votre pseudo" />
    <button onclick="login()">Entrer</button>
  </div>
</div>

<!-- Application -->
<div id="app">
  <div id="mainApp">
    <!-- Sidebar -->
    <div id="sidebar">
      <h2 id="welcome"></h2>
      <div id="contacts">
        <div class="contact">Demo Room</div>
      </div>
      <div id="logout" onclick="logout()">Déconnexion</div>
    </div>

    <!-- Contenu principal -->
    <div id="content">
      <!-- Chat -->
      <div id="chat">
        <div id="messages"></div>
        <div id="chatInput">
          <input id="msgInput" type="text" placeholder="Écrire un message..." />
          <button onclick="sendMsg()">Envoyer</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  let username = "";
  const socket = io();
  const room = "demo-room"; // salle fixe pour tester

  function login() {
    const input = document.getElementById("usernameInput");
    if (!input.value.trim()) {
      alert("Choisissez un pseudo !");
      return;
    }
    username = input.value;
    document.getElementById("welcome").textContent = "Bonjour " + username;

    // rejoindre la room sur le serveur
    socket.emit("join", room);

    document.getElementById("loginPage").style.display = "none";
    document.getElementById("app").style.display = "block";
  }

  function logout() {
    username = "";
    document.getElementById("loginPage").style.display = "flex";
    document.getElementById("app").style.display = "none";
  }

  function sendMsg() {
    const input = document.getElementById("msgInput");
    if (!input.value.trim()) return;
    const message = input.value;
    socket.emit("chat", { room, message, username });
    input.value = "";
  }

  // recevoir messages du serveur
  socket.on("chat", (m) => {
    const div = document.createElement("div");
    const t = new Date(m.time).toLocaleTimeString();
    div.textContent = `[${t}] ${m.username}: ${m.message}`;
    document.getElementById("messages").appendChild(div);
    document.getElementById("messages").scrollTop =
      document.getElementById("messages").scrollHeight;
  });
</script>

</body>
</html>
